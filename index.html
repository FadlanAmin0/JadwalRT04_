<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Jadwal Kegiatan Keagamaan RT 04 RW 021</title>
    <link
      href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="assets/css/style.css" />
  </head>
  <body style="opacity: 0; transition: opacity 0.7s">
    <!-- Spinner loading spiral untuk transisi halaman -->
    <div
      id="page-spinner"
      class="spinner"
      style="
        display: none;
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        z-index: 2000;
        pointer-events: none;
      "
    ></div>
    <header>
      <nav>
        <div class="navbar-content">
          <a href="index.html" id="logo-home" class="logo">üåê Logo</a>
          <ul>
            <li>
              <a href="/assets/pages/jadwal.html" id="nav-jadwal">Jadwal</a>
            </li>
            <li>
              <a href="/assets/pages/lokasi.html" id="nav-lokasi">Lokasi</a>
            </li>
            <li>
              <a href="/assets/pages/hadist.html" id="nav-hadist">Hadist</a>
            </li>
            <li>
              <a href="/assets/pages/tentangKami.html">Tentang Kami</a>
            </li>
            <li>
              <a href="#kontak-dkm" id="nav-kontak">Kontak</a>
            </li>
          </ul>
          <button
            id="toggle-theme"
            class="theme-toggle-btn"
            aria-label="Ganti Mode"
            title="Ganti Mode"
          >
            üåô
          </button>
        </div>
      </nav>
    </header>
    <main>
      <section
        class="welcome-section flex flex-col md:flex-row items-center justify-center py-8 rounded-lg shadow-md w-full max-w-none mt-8 mb-8"
        style="box-sizing: border-box; background: #dde6ed"
      >
        <div class="md:w-1/2 w-full text-left px-6">
          <h1 class="text-4xl font-bold my-4 text-gray-800">Assalamu‚Äôalaikum Warahmatullahi Wabarakatuh</h1>
          <h2 class="text-2xl font-semibold my-2 text-gray-700">
            Selamat Datang di Sistem Informasi Jadwalan Kegiatan Keagamaan Islam RT 04 RW 021 Desa Bojong Gede
          </h2>
          <p class="my-2 text-gray-600">
            Temukan informasi jadwal solat, jadwal kegiatan, lokasi masjid & musholla, serta hadist pilihan
          </p>
        </div>
        <div class="md:w-1/2 w-full flex justify-center items-center px-6">
          <div
            id="activity-slider"
            class="w-48 h-48 flex items-center justify-center"
          >
            <img
              id="activity-img"
              src="https://images.unsplash.com/photo-1564769625905-50e93615e769?w=400"
              alt="Kegiatan"
              class="w-48 h-48 object-cover rounded-lg shadow transition-all duration-500"
            />
          </div>
        </div>
      </section>
      <section>
        <div class="slider-container">
          <button class="slider-arrow prev" id="prevBtn">‚ùÆ</button>
          <div class="slider" id="slider">
            <img src="assets/img/masjid-ALbatul.jpg" alt="Masjid Siang" />
            <img src="assets/img/masjid-ALkautsar.jpg" alt="Masjid Malam" />
            <img
              src="assets/img/mushollah-baitulMuslim.jpeg"
              alt="Masjid Subuh"
            />
          </div>
          <button class="slider-arrow next" id="nextBtn">‚ùØ</button>
          <div class="slider-indicators">
            <div class="indicator active" data-slide="0"></div>
            <div class="indicator" data-slide="1"></div>
            <div class="indicator" data-slide="2"></div>
          </div>
        </div>
      </section>
      <section id="jadwal" class="my-6 mb-4 bg-[#ffd84d]">
        <h3 class="text-2xl font-semibold my-4 text-white">JADWAL SOLAT</h3>
        <div class="w-full flex justify-center mb-4 bg-[#1a2a47]">
          <div
            class="flex flex-col md:flex-row items-center gap-2 rounded-lg p-4 shadow w-full md:w-auto justify-center"
            style="background: linear-gradient(90deg, #1a2a47 30%, #ffd84d 70%)"
          >
            <select
              id="city"
              class="p-2 border-0 rounded-lg text-gray-700 shadow-sm focus:ring-2 focus:ring-[#ffd84d] focus:outline-none font-semibold min-w-[120px] mx-1"
            >
              <option value="Jakarta">Jakarta</option>
              <option value="Bogor">Bogor</option>
              <option value="Bandung">Bandung</option>
              <option value="Surabaya">Surabaya</option>
              <option value="Medan">Medan</option>
              <option value="Semarang">Semarang</option>
              <option value="Makassar">Makassar</option>
              <option value="Yogyakarta">Yogyakarta</option>
              <option value="Palembang">Palembang</option>
              <option value="Denpasar">Denpasar</option>
              <option value="Balikpapan">Balikpapan</option>
            </select>
            <select
              id="month-select"
              class="p-2 border-0 rounded-lg text-gray-700 shadow-sm focus:ring-2 focus:ring-[#ffd84d] focus:outline-none font-semibold min-w-[110px] mx-1"
            ></select>
            <select
              id="year-select"
              class="p-2 border-0 rounded-lg text-gray-700 shadow-sm focus:ring-2 focus:ring-[#ffd84d] focus:outline-none font-semibold min-w-[90px] mx-1"
            ></select>
            <span
              class="text-gray-800 text-base font-semibold mt-2 md:mt-0 md:ml-4"
              id="datetime-display"
              >Memuat tanggal...</span
            >
          </div>
        </div>
        <table class="schedule-table">
          <thead>
            <tr>
              <th>Tanggal</th>
              <th>Subuh</th>
              <th>Dzuhur</th>
              <th>Ashar</th>
              <th>Maghrib</th>
              <th>Isya</th>
            </tr>
          </thead>
          <tbody id="schedule-body">
            <!-- Data akan diisi oleh JavaScript -->
          </tbody>
        </table>
      </section>
    </main>

    <script>
      // Efek smooth transition (fade-in) pada body saat load
      document.addEventListener("DOMContentLoaded", function () {
        setTimeout(function () {
          document.body.style.opacity = 1;
        }, 80);
      });

      // Logo klik: smooth transition ke landing page jika dari halaman lain
      const logo = document.getElementById("logo-home");
      if (logo) {
        logo.addEventListener("click", function (e) {
          e.preventDefault();
          document.body.style.opacity = 0;
          setTimeout(function () {
            window.location.href = "index.html";
          }, 400);
        });
      }

      // Main Slider Functionality
      class MainSlider {
        constructor() {
          this.slider = document.getElementById("slider");
          this.prevBtn = document.getElementById("prevBtn");
          this.nextBtn = document.getElementById("nextBtn");
          this.indicators = document.querySelectorAll(".indicator");
          this.currentSlide = 0;
          this.totalSlides = 3;
          this.autoSlideInterval = null;
          this.init();
        }
        init() {
          this.prevBtn.addEventListener("click", () => this.prevSlide());
          this.nextBtn.addEventListener("click", () => this.nextSlide());
          this.indicators.forEach((indicator, index) => {
            indicator.addEventListener("click", () => this.goToSlide(index));
          });
          this.startAutoSlide();
          this.slider.parentElement.addEventListener("mouseenter", () =>
            this.stopAutoSlide()
          );
          this.slider.parentElement.addEventListener("mouseleave", () =>
            this.startAutoSlide()
          );
        }
        updateSlider() {
          const translateX = -this.currentSlide * 100;
          this.slider.style.transform = `translateX(${translateX}%)`;
          this.indicators.forEach((indicator, index) => {
            indicator.classList.toggle("active", index === this.currentSlide);
          });
        }
        nextSlide() {
          this.currentSlide = (this.currentSlide + 1) % this.totalSlides;
          this.updateSlider();
        }
        prevSlide() {
          this.currentSlide =
            (this.currentSlide - 1 + this.totalSlides) % this.totalSlides;
          this.updateSlider();
        }
        goToSlide(slideIndex) {
          this.currentSlide = slideIndex;
          this.updateSlider();
        }
        startAutoSlide() {
          this.stopAutoSlide();
          this.autoSlideInterval = setInterval(() => {
            this.nextSlide();
          }, 4000);
        }
        stopAutoSlide() {
          if (this.autoSlideInterval) {
            clearInterval(this.autoSlideInterval);
            this.autoSlideInterval = null;
          }
        }
      }
      // Activity Slider Functionality
      class ActivitySlider {
        constructor() {
          this.activityImg = document.getElementById("activity-img");
          this.images = [
            "assets/img/ngaji11.jpg",
            "assets/img/ngaji2.jpg",
            "assets/img/ngaji3.jpg",
            "assets/img/qasidah.png",
          ];
          this.currentIndex = 0;
          this.init();
        }
        init() {
          this.startAutoRotate();
        }
        changeImage() {
          this.activityImg.style.opacity = "0";
          setTimeout(() => {
            this.currentIndex = (this.currentIndex + 1) % this.images.length;
            this.activityImg.src = this.images[this.currentIndex];
            this.activityImg.alt = `Kegiatan ${this.currentIndex + 1}`;
            this.activityImg.style.opacity = "1";
          }, 350);
        }
        startAutoRotate() {
          setInterval(() => {
            this.changeImage();
          }, 3000);
        }
      }
      // Prayer Schedule API Handler with Al-Adhan API
      class PrayerScheduleAPI {
        constructor() {
          this.citySelect = document.getElementById("city");
          this.monthSelect = document.getElementById("month-select");
          this.yearSelect = document.getElementById("year-select");
          this.scheduleBody = document.getElementById("schedule-body");
          this.currentCity = "Jakarta";
          this.currentMonth = new Date().getMonth() + 1; // 1-based
          this.currentYear = new Date().getFullYear();
          this.init();
        }
        init() {
          // Isi dropdown bulan dan tahun
          this.populateMonthYear();
          // Load initial schedule
          this.fetchPrayerTimesForMonth(
            this.currentCity,
            this.currentMonth,
            this.currentYear
          );
          // Event listeners
          this.citySelect.addEventListener("change", (e) => {
            this.currentCity = e.target.value;
            this.fetchPrayerTimesForMonth(
              this.currentCity,
              this.currentMonth,
              this.currentYear
            );
          });
          this.monthSelect.addEventListener("change", (e) => {
            this.currentMonth = parseInt(e.target.value);
            this.fetchPrayerTimesForMonth(
              this.currentCity,
              this.currentMonth,
              this.currentYear
            );
          });
          this.yearSelect.addEventListener("change", (e) => {
            this.currentYear = parseInt(e.target.value);
            this.fetchPrayerTimesForMonth(
              this.currentCity,
              this.currentMonth,
              this.currentYear
            );
          });
          // Update date and time
          this.updateDateTime();
          setInterval(() => this.updateDateTime(), 1000);
        }
        populateMonthYear() {
          const monthNames = [
            "Januari",
            "Februari",
            "Maret",
            "April",
            "Mei",
            "Juni",
            "Juli",
            "Agustus",
            "September",
            "Oktober",
            "November",
            "Desember",
          ];
          this.monthSelect.innerHTML = monthNames
            .map(
              (name, idx) =>
                `<option value="${idx + 1}"${
                  idx + 1 === this.currentMonth ? " selected" : ""
                }>${name}</option>`
            )
            .join("");
          const thisYear = new Date().getFullYear();
          let yearOptions = "";
          for (let y = thisYear - 2; y <= thisYear + 2; y++) {
            yearOptions += `<option value="${y}"${
              y === this.currentYear ? " selected" : ""
            }>${y}</option>`;
          }
          this.yearSelect.innerHTML = yearOptions;
        }
        async fetchPrayerTimesForMonth(city, month, year) {
          try {
            this.setLoadingState();
            const cityMap = {
              Jakarta: "Jakarta",
              Bogor: "Bogor",
              Bandung: "Bandung",
              Surabaya: "Surabaya",
              Medan: "Medan",
              Semarang: "Semarang",
              Makassar: "Makassar",
              Yogyakarta: "Yogyakarta",
              Palembang: "Palembang",
              Denpasar: "Denpasar",
              Balikpapan: "Balikpapan",
            };
            const mappedCity = cityMap[city] || city;
            // API calendarByCity: 1x fetch untuk 1 bulan
            const response = await fetch(
              `https://api.aladhan.com/v1/calendarByCity?city=${encodeURIComponent(
                mappedCity
              )}&country=Indonesia&method=2&month=${month}&year=${year}`
            );
            if (!response.ok)
              throw new Error("Gagal mengambil data jadwal solat");
            const data = await response.json();
            if (data.code !== 200 || !data.data)
              throw new Error("Data tidak valid");
            const scheduleData = data.data.map((item) => {
              const tgl = item.date.gregorian.date.split("-");
              // tgl: [DD, MM, YYYY]
              return {
                date: `${tgl[0]}-${tgl[1]}-${tgl[2]}`,
                subuh: this.formatTime(item.timings.Fajr),
                dzuhur: this.formatTime(item.timings.Dhuhr),
                ashar: this.formatTime(item.timings.Asr),
                maghrib: this.formatTime(item.timings.Maghrib),
                isya: this.formatTime(item.timings.Isha),
                isToday: this.isToday(
                  parseInt(tgl[0]),
                  parseInt(tgl[1]),
                  parseInt(tgl[2])
                ),
              };
            });
            this.updateScheduleDisplay(scheduleData);
          } catch (error) {
            console.error("Error fetching prayer times:", error.message);
            this.setErrorState();
            this.updateScheduleDisplay(
              this.getFallbackScheduleForMonth(city, month, year)
            );
          }
        }
        isToday(day, month, year) {
          const now = new Date();
          return (
            now.getDate() === day &&
            now.getMonth() + 1 === month &&
            now.getFullYear() === year
          );
        }
        formatTime(time) {
          return time ? time.split(" ")[0].substring(0, 5) : "N/A";
        }
        setLoadingState() {
          this.scheduleBody.innerHTML = `
            <tr>
              <td colspan="6" class="text-center py-8">
                <div class="spinner"></div>
                <div class="mt-2 text-gray-700 font-medium loading">Memuat...</div>
              </td>
            </tr>
          `;
        }
        setErrorState() {
          this.scheduleBody.innerHTML = `
            <tr><td colspan="6" class="text-gray-700 font-medium error text-center">Error</td></tr>
          `;
        }
        updateScheduleDisplay(scheduleData) {
          this.scheduleBody.innerHTML = "";
          scheduleData.forEach((day) => {
            const row = document.createElement("tr");
            row.innerHTML = `
              <td class="text-gray-700 font-medium${
                day.isToday ? " bg-yellow-100 rounded font-bold" : ""
              }">${day.date}</td>
              <td class="text-gray-700 font-medium${
                day.isToday ? " bg-yellow-100 rounded font-bold" : ""
              }">${day.subuh}</td>
              <td class="text-gray-700 font-medium${
                day.isToday ? " bg-yellow-100 rounded font-bold" : ""
              }">${day.dzuhur}</td>
              <td class="text-gray-700 font-medium${
                day.isToday ? " bg-yellow-100 rounded font-bold" : ""
              }">${day.ashar}</td>
              <td class="text-gray-700 font-medium${
                day.isToday ? " bg-yellow-100 rounded font-bold" : ""
              }">${day.maghrib}</td>
              <td class="text-gray-700 font-medium${
                day.isToday ? " bg-yellow-100 rounded font-bold" : ""
              }">${day.isya}</td>
            `;
            this.scheduleBody.appendChild(row);
          });
        }
        getFallbackScheduleForMonth(city, month, year) {
          const baseTimes = {
            Jakarta: {
              subuh: "04:41",
              dzuhur: "11:55",
              ashar: "15:17",
              maghrib: "17:48",
              isya: "19:01",
            },
            Bogor: {
              subuh: "04:39",
              dzuhur: "11:54",
              ashar: "15:16",
              maghrib: "17:47",
              isya: "19:00",
            },
            Bandung: {
              subuh: "04:45",
              dzuhur: "12:00",
              ashar: "15:20",
              maghrib: "17:50",
              isya: "19:05",
            },
            Surabaya: {
              subuh: "04:30",
              dzuhur: "11:50",
              ashar: "15:15",
              maghrib: "17:45",
              isya: "19:00",
            },
            Medan: {
              subuh: "05:00",
              dzuhur: "12:15",
              ashar: "15:35",
              maghrib: "18:05",
              isya: "19:20",
            },
            Semarang: {
              subuh: "04:40",
              dzuhur: "11:55",
              ashar: "15:18",
              maghrib: "17:47",
              isya: "19:02",
            },
            Makassar: {
              subuh: "04:50",
              dzuhur: "12:05",
              ashar: "15:25",
              maghrib: "17:55",
              isya: "19:10",
            },
            Yogyakarta: {
              subuh: "04:42",
              dzuhur: "11:57",
              ashar: "15:19",
              maghrib: "17:49",
              isya: "19:03",
            },
            Palembang: {
              subuh: "04:48",
              dzuhur: "12:02",
              ashar: "15:22",
              maghrib: "17:52",
              isya: "19:07",
            },
            Denpasar: {
              subuh: "04:55",
              dzuhur: "12:10",
              ashar: "15:30",
              maghrib: "18:00",
              isya: "19:15",
            },
            Balikpapan: {
              subuh: "04:52",
              dzuhur: "12:07",
              ashar: "15:27",
              maghrib: "17:57",
              isya: "19:12",
            },
          };
          const scheduleData = [];
          const daysInMonth = new Date(year, month + 1, 0).getDate();
          const times = baseTimes[city] || baseTimes["Jakarta"];
          for (let d = 1; d <= daysInMonth; d++) {
            const day = String(d).padStart(2, "0");
            const m = String(month + 1).padStart(2, "0");
            scheduleData.push({
              date: `${day}-${m}-${year}`,
              subuh: times.subuh,
              dzuhur: times.dzuhur,
              ashar: times.ashar,
              maghrib: times.maghrib,
              isya: times.isya,
              isToday: this.isToday(d, month, year),
            });
          }
          return scheduleData;
        }
        updateDateTime() {
          const now = new Date();
          const options = {
            weekday: "long",
            year: "numeric",
            month: "long",
            day: "numeric",
            timeZone: "Asia/Jakarta",
          };
          const timeOptions = {
            hour: "2-digit",
            minute: "2-digit",
            timeZone: "Asia/Jakarta",
          };
          const dateStr = now.toLocaleDateString("id-ID", options);
          const timeStr = now.toLocaleTimeString("id-ID", timeOptions);
          const dateTimeElement = document.getElementById("datetime-display");
          if (dateTimeElement) {
            dateTimeElement.textContent = `${dateStr} - ${timeStr} WIB`;
          }
        }
      }
      // Spinner page transition
      function showPageSpinner() {
        var spinner = document.getElementById("page-spinner");
        if (spinner) {
          spinner.style.removeProperty("display"); // pastikan display:block dari CSS
          spinner.classList.remove("no-spin"); // jika ada class aneh
        }
      }
      function hidePageSpinner() {
        var spinner = document.getElementById("page-spinner");
        if (spinner) spinner.style.display = "none";
      }

      // Efek smooth transition (fade-in) pada body saat load
      document.addEventListener("DOMContentLoaded", function () {
        setTimeout(function () {
          document.body.style.opacity = 1;
          hidePageSpinner();
        }, 80);
      });

      // Spinner saat klik link/menu (navigasi antar halaman)
      document.body.addEventListener(
      "click",
      function (e) {
        var a = e.target.closest("a");
        if (
          a &&
          a.href &&
          !a.target &&
          a.hostname === location.hostname
        ) {
          // Jangan tampilkan spinner jika hanya scroll ke anchor di halaman yang sama
          if (
            a.hash && 
            (a.pathname === location.pathname || a.pathname === "" || a.pathname === "/") &&
            a.hash !== "" &&
            a.href.split("#")[0] === location.href.split("#")[0]
          ) {
            // Anchor link, tidak perlu spinner
            return;
          }
          // Tampilkan spinner hanya jika benar-benar pindah halaman
          if (a.href !== location.href && !a.href.endsWith("#")) {
            showPageSpinner();
            document.body.style.opacity = 0.3;
          }
        }
      },
      true
    );

      // Initialize all components when DOM is loaded
      document.addEventListener("DOMContentLoaded", () => {
        new MainSlider();
        new ActivitySlider();
        new PrayerScheduleAPI();
      });
    </script>
    <script>
      // Theme toggle
      const themeBtn = document.getElementById("toggle-theme");
      function setTheme(dark) {
        if (dark) {
          document.body.classList.add("dark-mode");
          themeBtn.textContent = "‚òÄÔ∏è";
          localStorage.setItem("theme", "dark");
        } else {
          document.body.classList.remove("dark-mode");
          themeBtn.textContent = "üåô";
          localStorage.setItem("theme", "light");
        }
      }
      themeBtn.addEventListener("click", () => {
        setTheme(!document.body.classList.contains("dark-mode"));
      });
      document.addEventListener("DOMContentLoaded", () => {
        setTheme(localStorage.getItem("theme") === "dark");
      });
      document.addEventListener("scroll", function() {
      var footer = document.getElementById("kontak-dkm");
      var navKontak = document.getElementById("nav-kontak");
      if (!footer || !navKontak) return;
      var rect = footer.getBoundingClientRect();
      if (rect.top < window.innerHeight && rect.bottom > 0) {
        navKontak.classList.add("active");
      } else {
        navKontak.classList.remove("active");
      }
    });
    </script>
  </body>
  <!-- Footer Start -->
  <footer id="kontak-dkm" style="background: linear-gradient(90deg, #357abd 0%, #1a2a47 100%); color: #fff; padding: 32px 0 16px 0; margin-top: 48px;">
    <div style="max-width: 1200px; margin: 0 auto; display: flex; flex-wrap: wrap; align-items: flex-start; justify-content: space-between; gap: 24px; padding: 0 24px;">
      <!-- Logo & Nama -->
      <div style="flex: 1 1 200px; min-width: 180px;">
        <div style="display: flex; align-items: center; gap: 12px;">
          <img src="/assets/img/logo-masjid.png" alt="Logo Masjid" style="width: 48px; height: 48px; border-radius: 50%; background: #fff; object-fit: cover;" />
          <div>
            <div style="font-size: 1.2rem; font-weight: bold;">DKM Masjid RT 04 RW 021</div>
            <div style="font-size: 0.95rem;">Desa Bojong Gede</div>
          </div>
        </div>
      </div>
      <!-- Alamat & Kontak -->
      <div style="flex: 2 1 320px; min-width: 220px;">
        <div style="margin-bottom: 8px;">
          <b>Alamat:</b><br>
          Jl. Masjid RT 04 RW 021, Desa Bojong Gede, Kec. Bojong Gede, Kab. Bogor, Jawa Barat 16922
        </div>
        <div>
          <b>Kontak DKM:</b><br>
          <a href="tel:+6281234567890" style="color: #ffd84d; text-decoration: underline;">+62 812-3456-7890</a>
        </div>
      </div>
      <!-- Map -->
      <div style="flex: 1 1 160px; min-width: 120px; text-align: center;">
        <a href="https://maps.app.goo.gl/1nsqZLNS2VxvRgS4A" target="_blank" rel="noopener" title="Lihat lokasi di Google Maps">
          <img src="/assets/img/maps.png" alt="Map Lokasi Masjid" style="width: 300px; height: 200px; border-radius: 8px; border: 2px solid #ffd84d; object-fit: cover; box-shadow: 0 2px 8px rgba(0,0,0,0.12);" />
          <div style="margin-top: 4px; color: #ffd84d; font-size: 0.95rem;">Lihat di Google Maps</div>
        </a>
      </div>
    </div>
    <div style="text-align: center; color: #ffd84d; font-size: 0.95rem; margin-top: 24px;">
      &copy; 2025 DKM Masjid RT 04 RW 021. All rights reserved.
    </div>
  </footer>
<!-- Footer End -->
</html>
